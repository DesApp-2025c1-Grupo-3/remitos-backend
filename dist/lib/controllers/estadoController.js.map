{"version":3,"sources":["../../../lib/controllers/estadoController.js"],"names":["includes","isNull","require","Estado","message","controller","getEstado","req","res","estados","findAll","where","activo","status","json","getEstadoById","id","params","estado","findByPk","createEstado","body","estadoNuevo","create","updateEstado","idEstado","descripcion","update","deleteEstado","estadoId","reload","error","console","module","exports"],"mappings":"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","sourcesContent":["const { includes, isNull } = require(\"lodash\");\r\nconst { Estado } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getEstado = async (req, res) => {\r\n  const estados = await Estado.findAll({\r\n    where: { activo: true }, //Solo trae estados activos\r\n    // order: [[\"descripcion\", \"ASC\"]], // Ordena por descripcion ascendente\r\n  });\r\n  res.status(200).json(estados);\r\n};\r\n\r\ncontroller.getEstado = getEstado;\r\n\r\nconst getEstadoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const estado = await Estado.findByPk(id); \r\n  res.status(200).json(estado);\r\n};\r\ncontroller.getEstadoById = getEstadoById;\r\n\r\n// Este crea al estado con \"activo\" y \"descripcion\"\r\nconst createEstado = async (req, res) => {\r\n  const estado = req.body;\r\n  const estadoNuevo = await Estado.create(estado);\r\n  res.status(201).json(estadoNuevo);\r\n};\r\ncontroller.createEstado = createEstado;\r\n\r\n/*\r\n// Crea un nuevo estado en la base de datos sin \"activo\"\r\nconst createEstado = async (req, res) => {\r\n  const estado = req.body;\r\n  const nuevoEstado = await Estado.create(estado);\r\n  res.status(201).json(nuevoEstado);\r\n};\r\ncontroller.createEstado = createEstado;\r\n*/\r\n\r\nconst updateEstado = async (req, res) => {\r\n  const idEstado = req.params.id;\r\n  const { descripcion } = req.body;\r\n  const estado = await Estado.findByPk(idEstado); //Arreglar para que a los estados inactivos no los traiga\r\n  if (estado.activo === false) {\r\n    return res.status(404).json({ message: \"Estado no encontrado\" });\r\n  }\r\n  await estado.update({ descripcion });\r\n  res.status(200).json({ message: \"Estado Actualizado\", estado });\r\n};\r\ncontroller.updateEstado = updateEstado;\r\n\r\n\r\nconst deleteEstado = async (req, res) => {\r\n  try {\r\n    const estadoId = req.params.id;\r\n    const estado = await Estado.findByPk(estadoId);\r\n\r\n    if (!estado || !estado.activo) {\r\n      return res.status(404).json({ message: \"Estado no encontrado o inactivo.\" });\r\n    }\r\n\r\n    await estado.update({ activo: false });\r\n    await estado.reload(); // refresca estado con el nuevo valor\r\n\r\n    return res.status(200).json({\r\n      message: \"Estado eliminado (lógicamente).\",\r\n      estado,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error en deleteEstado:\", error);\r\n    return res.status(500).json({ message: \"Error al eliminar el estado.\" });\r\n  }\r\n};\r\ncontroller.deleteEstado = deleteEstado;\r\n/*\r\n // Si se quiere eliminar de la base de datos, se puede usar este método\r\n //  pero es mejor usar un campo activo para no perder el historial de estados.\r\nconst deleteEstado = async (req, res) => {\r\n  const idEstado = req.params.id;\r\n  const estado = await Estado.destroy({ where: { id: idEstado } });\r\n  res.status(200).json(estado);\r\n};\r\ncontroller.deleteEstado = deleteEstado; \r\n*/\r\n\r\nmodule.exports = controller;\r\n"],"file":"estadoController.js"}