{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","controller","getDestino","req","res","page","parseInt","params","limit","offset","count","rows","findAndCountAll","activo","include","model","as","order","status","json","totalItems","totalPages","Math","ceil","currentPage","data","getDestinoById","id","destinos","findByPk","getDestinoFiltrado","pais","provincia","localidad","query","filtros","findAll","createDestino","destino","body","nuevoDestino","create","createDestinoWithContacto","nombre","direccion","contactos","Array","isArray","length","message","nuevosContactos","Promise","all","map","contacto","destinoId","destinoConContacto","addContactoToDestino","idDestino","nuevoContacto","createContacto","clienteActualizado","error","console","updateDestino","update","activateDestino","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\nconst { Destino, Contacto } = require(\"../models\");\nconst controller = {};\n\nconst getDestino = async (req, res) => {\n  const page = parseInt(req.params.page) || 1;\n  const limit = parseInt(req.params.limit) || 20;\n  const offset = (page - 1) * limit; // permite saltear los que son de paginas anteriores\n  const { count, rows } = await Destino.findAndCountAll({\n    where: { activo: true },\n    include: { model: Contacto, as: \"contactos\" },\n    limit,\n    offset,\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n  res.status(200).json({\n    totalItems: count,\n    totalPages: Math.ceil(count / limit),\n    currentPage: page,\n    data: rows,\n  });\n};\ncontroller.getDestino = getDestino;\n\nconst getDestinoById = async (req, res) => {\n  const id = req.params.id;\n  const destinos = await Destino.findByPk(id, {\n    include: { model: Contacto, as: \"contactos\" },\n  });\n  res.status(200).json(destinos);\n};\ncontroller.getDestinoById = getDestinoById;\n\nconst getDestinoFiltrado = async (req, res) => {\n  const { pais, provincia, localidad } = req.query;\n  const filtros = {};\n  if (pais) filtros.pais = pais;\n  if (provincia) filtros.provincia = provincia;\n  if (localidad) filtros.localidad = localidad;\n  const destinos = await Destino.findAll({ where: filtros });\n  res.status(200).json(destinos);\n};\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\n\nconst createDestino = async (req, res) => {\n  const destino = req.body;\n  const nuevoDestino = await Destino.create(destino);\n  res.status(201).json(nuevoDestino);\n};\ncontroller.createDestino = createDestino;\n\nconst createDestinoWithContacto = async (req, res) => {\n  const { nombre, pais, provincia, localidad, direccion, contactos } = req.body;\n  const destino = await Destino.create({\n    nombre,\n    pais,\n    provincia,\n    localidad,\n    direccion,\n  });\n  if (!Array.isArray(contactos) || contactos.length === 0) {\n    return res\n      .status(400)\n      .json({ message: \"Se requiere al menos un contacto.\" });\n  }\n  const nuevosContactos = await Promise.all(\n    contactos.map((contacto) =>\n      Contacto.create({ ...contacto, destinoId: destino.id })\n    )\n  );\n  const destinoConContacto = await Destino.findByPk(destino.id, {\n    include: { model: Contacto, as: \"contactos\" },\n  });\n  res.status(200).json(destinoConContacto);\n};\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\n\nconst addContactoToDestino = async (req, res) => {\n  try {\n    const idDestino = req.params.id;\n    const nuevoContacto = req.body;\n    const destino = await Destino.findByPk(idDestino);\n    await destino.createContacto(nuevoContacto);\n    const clienteActualizado = await Destino.findByPk(idDestino, {\n      include: { model: Contacto, as: \"contactos\" },\n    });\n    return res.status(200).json(clienteActualizado);\n  } catch (error) {\n    console.error(\"Error en cargar contacto:\", error);\n    return res.status(500).json({ message: \"Error al cargar contacto\" });\n  }\n};\ncontroller.addContactoToDestino = addContactoToDestino;\n\nconst updateDestino = async (req, res) => {\n  const { pais, provincia, localidad, direccion } = req.body;\n  const idDestino = req.params.id;\n  const destino = await Destino.findByPk(idDestino);\n  await destino.update({ pais, provincia, localidad, direccion });\n  res.status(200).json(destino);\n};\ncontroller.updateDestino = updateDestino;\n\nconst activateDestino = async (req, res) => {\n  const idDestino = req.params.id;\n  const destino = await Destino.findByPk(idDestino);\n  await destino.update({ activo: true });\n  res.status(200).json(destino);\n};\ncontroller.activateDestino = activateDestino;\n\nconst deleteDestino = async (req, res) => {\n  const idDestino = req.params.id;\n  const destino = await Destino.findByPk(idDestino);\n  await destino.update({ activo: false });\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\n};\ncontroller.deleteDestino = deleteDestino;\n\nmodule.exports = controller;\n"],"file":"destinoController.js"}