{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","message","controller","getDestino","req","res","destinos","findAll","include","model","as","status","json","getDestinoById","id","params","destino","findByPk","getDestinoFiltrado","pais","provincia","localidad","query","filtros","createDestino","body","nuevoDestino","create","createDestinoWithContacto","nombre","direccion","contactos","contacto","destinoId","destinoConContacto","updateDestino","idDestino","update","destroy","destinoActualizado","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getDestino = async (req, res) => {\r\n  const destinos = await Destino.findAll({\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const destino = await Destino.findByPk(id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { pais, provincia, localidad } = req.query;\r\n  const filtros = {};\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  const destinos = await Destino.findAll({ where: filtros });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json(nuevoDestino);\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const { nombre, pais, provincia, localidad, direccion, contactos } = req.body;\r\n  const destino = await Destino.create({\r\n    nombre,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n  });\r\n\r\n  for (const contacto of contactos) {\r\n    await Contacto.create({\r\n      ...contacto,\r\n      destinoId: destino.id,\r\n    });\r\n  }\r\n\r\n  const destinoConContacto = await Destino.findByPk(destino.id, {\r\n    include: {\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(destinoConContacto);\r\n};\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { nombre, pais, provincia, localidad, direccion, contactos } = req.body;\r\n  const idDestino = req.params.id;\r\n\r\n  const destino = await Destino.findByPk(idDestino);\r\n  if (destino) {\r\n    await destino.update({ nombre, pais, provincia, localidad, direccion });\r\n\r\n    await Contacto.destroy({ where: { destinoId: idDestino } });\r\n\r\n    for (const contacto of contactos) {\r\n      await Contacto.create({\r\n        ...contacto,\r\n        destinoId: idDestino,\r\n      });\r\n    }\r\n  }\r\n\r\n  const destinoActualizado = await Destino.findByPk(idDestino, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n\r\n  res.status(200).json(destinoActualizado);\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\nconst deleteDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  await Contacto.destroy({ where: { destinoId: idDestino } });\r\n  await Destino.destroy({ where: { id: idDestino } });\r\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}