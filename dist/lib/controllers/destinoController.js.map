{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","message","controller","getDestino","req","res","page","parseInt","params","limit","offset","count","rows","findAndCountAll","activo","include","model","as","order","status","json","totalItems","totalPages","Math","ceil","currentPage","data","getDestinoById","id","destinos","findByPk","getDestinoFiltrado","pais","provincia","localidad","query","filtros","findAll","createDestino","destino","body","nuevoDestino","create","createDestinoWithContacto","nombre","direccion","personaAutorizada","correoElectronico","telefono","nuevoContacto","destinoId","destinoConContacto","updateDestino","idDestino","update","activateDestino","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getDestino = async (req, res) => {\r\n  const page = parseInt(req.params.page) || 1;\r\n  const limit = parseInt(req.params.limit) || 20;\r\n  const offset = (page - 1) * limit; // permite saltear los que son de paginas anteriores\r\n  const { count, rows } = await Destino.findAndCountAll({\r\n    where: { activo: true },\r\n    include: { model: Contacto, as: \"contactos\" },\r\n    limit,\r\n    offset,\r\n    order: [[\"createdAt\", \"DESC\"]],\r\n  });\r\n  res.status(200).json({\r\n    totalItems: count,\r\n    totalPages: Math.ceil(count / limit),\r\n    currentPage: page,\r\n    data: rows,\r\n  });\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const destinos = await Destino.findByPk(id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { pais, provincia, localidad } = req.query;\r\n  const filtros = {};\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  const destinos = await Destino.findAll({ where: filtros });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json(nuevoDestino);\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const {\r\n    nombre,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n  } = req.body;\r\n  const destino = await Destino.create({\r\n    nombre,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n  });\r\n  const nuevoContacto = await Contacto.create({\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n    destinoId: destino.id,\r\n  });\r\n  const destinoConContacto = await Destino.findByPk(destino.id, {\r\n    include: {\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(destinoConContacto);\r\n};\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { pais, provincia, localidad, direccion } = req.body;\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ pais, provincia, localidad, direccion });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\nconst activateDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ activo: true });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.activateDestino = activateDestino;\r\n\r\nconst deleteDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ activo: false });\r\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}