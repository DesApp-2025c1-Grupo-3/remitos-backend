{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","sequelize","message","controller","getDestino","req","res","page","parseInt","query","limit","offset","nombre","Op","iLike","provincia","localidad","direccion","count","rows","findAndCountAll","include","model","as","order","status","json","data","totalItems","totalPages","Math","ceil","currentPage","error","console","getDestinoById","id","params","destino","findByPk","getDestinoFiltrado","pais","filtros","destinos","findAll","createDestino","t","transaction","contactos","destinoData","body","create","Array","isArray","length","contacto","destinoId","commit","destinoConContactos","rollback","createDestinoWithContacto","destinoConContacto","updateDestino","idDestino","update","destroy","destinoActualizado","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\nconst { Destino, Contacto, sequelize } = require(\"../models\");\nconst { message } = require(\"../schemas/estadoSchema\");\nconst controller = {};\n\nconst getDestino = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page, 10) || 1;\n    const limit = parseInt(req.query.limit, 10) || 20;\n    const offset = (page - 1) * limit;\n\n    // Filtros de bÃºsqueda\n    const where = {};\n    if (req.query.nombre) {\n      where.nombre = {\n        [require(\"sequelize\").Op.iLike]: `%${req.query.nombre}%`,\n      };\n    }\n    if (req.query.provincia) {\n      where.provincia = {\n        [require(\"sequelize\").Op.iLike]: `%${req.query.provincia}%`,\n      };\n    }\n    if (req.query.localidad) {\n      where.localidad = {\n        [require(\"sequelize\").Op.iLike]: `%${req.query.localidad}%`,\n      };\n    }\n    if (req.query.direccion) {\n      where.direccion = {\n        [require(\"sequelize\").Op.iLike]: `%${req.query.direccion}%`,\n      };\n    }\n\n    const { count, rows } = await Destino.findAndCountAll({\n      where,\n      limit,\n      offset,\n      include: { model: Contacto, as: \"contactos\" },\n      order: [[\"createdAt\", \"DESC\"]],\n    });\n\n    res.status(200).json({\n      data: rows,\n      totalItems: count,\n      totalPages: Math.ceil(count / limit),\n      currentPage: page,\n    });\n  } catch (error) {\n    console.error(\"Error al obtener destinos:\", error);\n    res.status(500).json({ message: \"Error al obtener los destinos\" });\n  }\n};\ncontroller.getDestino = getDestino;\n\nconst getDestinoById = async (req, res) => {\n  const id = req.params.id;\n  const destino = await Destino.findByPk(id, {\n    include: { model: Contacto, as: \"contactos\" },\n  });\n  res.status(200).json(destino);\n};\ncontroller.getDestinoById = getDestinoById;\n\nconst getDestinoFiltrado = async (req, res) => {\n  const { pais, provincia, localidad } = req.query;\n  const filtros = {};\n  if (pais) filtros.pais = pais;\n  if (provincia) filtros.provincia = provincia;\n  if (localidad) filtros.localidad = localidad;\n  const destinos = await Destino.findAll({ where: filtros });\n  res.status(200).json(destinos);\n};\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\n\nconst createDestino = async (req, res) => {\n  const t = await sequelize.transaction();\n\n  try {\n    const { contactos, ...destinoData } = req.body;\n\n    const destino = await Destino.create(destinoData, { transaction: t });\n\n    // Crear contactos si se proporcionan\n    if (contactos && Array.isArray(contactos) && contactos.length > 0) {\n      for (const contacto of contactos) {\n        await Contacto.create(\n          {\n            ...contacto,\n            destinoId: destino.id,\n          },\n          { transaction: t }\n        );\n      }\n    }\n\n    await t.commit();\n\n    // Devolver destino con contactos\n    const destinoConContactos = await Destino.findByPk(destino.id, {\n      include: {\n        model: Contacto,\n        as: \"contactos\",\n      },\n    });\n\n    res.status(201).json(destinoConContactos);\n  } catch (error) {\n    await t.rollback();\n    console.error(\"Error al crear destino:\", error);\n    res.status(500).json({ message: \"Error al crear el destino\" });\n  }\n};\ncontroller.createDestino = createDestino;\n\nconst createDestinoWithContacto = async (req, res) => {\n  const t = await sequelize.transaction();\n\n  try {\n    const {\n      nombre,\n      pais,\n      provincia,\n      localidad,\n      direccion,\n      contactos,\n    } = req.body;\n\n    const destino = await Destino.create(\n      {\n        nombre,\n        pais,\n        provincia,\n        localidad,\n        direccion,\n      },\n      { transaction: t }\n    );\n\n    // Crear contactos\n    if (contactos && Array.isArray(contactos) && contactos.length > 0) {\n      for (const contacto of contactos) {\n        await Contacto.create(\n          {\n            ...contacto,\n            destinoId: destino.id,\n          },\n          { transaction: t }\n        );\n      }\n    }\n\n    await t.commit();\n\n    const destinoConContacto = await Destino.findByPk(destino.id, {\n      include: {\n        model: Contacto,\n        as: \"contactos\",\n      },\n    });\n    res.status(201).json(destinoConContacto);\n  } catch (error) {\n    await t.rollback();\n    console.error(\"Error al crear destino con contacto:\", error);\n    res.status(500).json({ message: \"Error al crear el destino con contacto\" });\n  }\n};\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\n\nconst updateDestino = async (req, res) => {\n  const t = await sequelize.transaction();\n\n  try {\n    const {\n      nombre,\n      pais,\n      provincia,\n      localidad,\n      direccion,\n      contactos,\n    } = req.body;\n    const idDestino = req.params.id;\n\n    const destino = await Destino.findByPk(idDestino);\n    if (!destino) {\n      await t.rollback();\n      return res.status(404).json({ message: \"Destino no encontrado\" });\n    }\n\n    await destino.update(\n      {\n        nombre,\n        pais,\n        provincia,\n        localidad,\n        direccion,\n      },\n      { transaction: t }\n    );\n\n    // Actualizar contactos si se proporcionan\n    if (contactos && Array.isArray(contactos)) {\n      // Eliminar contactos existentes\n      await Contacto.destroy({\n        where: { destinoId: idDestino },\n        transaction: t,\n      });\n\n      // Crear nuevos contactos\n      for (const contacto of contactos) {\n        await Contacto.create(\n          {\n            ...contacto,\n            destinoId: idDestino,\n          },\n          { transaction: t }\n        );\n      }\n    }\n\n    await t.commit();\n\n    const destinoActualizado = await Destino.findByPk(idDestino, {\n      include: { model: Contacto, as: \"contactos\" },\n    });\n\n    res.status(200).json(destinoActualizado);\n  } catch (error) {\n    await t.rollback();\n    console.error(\"Error al actualizar destino:\", error);\n    res.status(500).json({ message: \"Error al actualizar el destino\" });\n  }\n};\ncontroller.updateDestino = updateDestino;\n\nconst deleteDestino = async (req, res) => {\n  const t = await sequelize.transaction();\n\n  try {\n    const idDestino = req.params.id;\n\n    // Eliminar contactos primero\n    await Contacto.destroy({\n      where: { destinoId: idDestino },\n      transaction: t,\n    });\n\n    // Luego eliminar destino\n    await Destino.destroy({\n      where: { id: idDestino },\n      transaction: t,\n    });\n\n    await t.commit();\n    res.status(200).json({ message: \"Destino eliminado correctamente\" });\n  } catch (error) {\n    await t.rollback();\n    console.error(\"Error al eliminar destino:\", error);\n    res.status(500).json({ message: \"Error al eliminar el destino\" });\n  }\n};\ncontroller.deleteDestino = deleteDestino;\n\nmodule.exports = controller;\n"],"file":"destinoController.js"}