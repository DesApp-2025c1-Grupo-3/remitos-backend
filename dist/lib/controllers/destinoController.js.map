{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","message","controller","getDestino","req","res","destinos","findAll","include","model","as","status","json","getDestinoById","id","params","getDestinoFiltrado","pais","provincia","localidad","query","filtros","createDestino","destino","body","nuevoDestino","create","createDestinoWithContacto","direccion","personaAutorizada","correoElectronico","telefono","nuevoContacto","destinoId","destinoConContacto","findByPk","updateDestino","idDestino","update","deleteDestino","activo","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getDestino = async (req, res) => {\r\n  const destinos = await Destino.findAll({\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const destinos = await Destino.findAll(id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { pais, provincia, localidad } = req.query;\r\n  const filtros = {};\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  const destinos = await Destino.findAll({ where: filtros });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json(nuevoDestino);\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const {\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n  } = req.body;\r\n  const destino = await Destino.create({\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n  });\r\n  const nuevoContacto = await Contacto.create({\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n    destinoId: destino.id,\r\n  });\r\n  const destinoConContacto = await Destino.findByPk(destino.id, {\r\n    include: {\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(destinoConContacto);\r\n};\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { pais, provincia, localidad, direccion } = req.body;\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ pais, provincia, localidad, direccion });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\n// Se elimina el destino marcándolo como inactivo, no se elimina de la base de datos.\r\nconst deleteDestino = async (req, res) => {\r\n  const destinoId = req.params.id;\r\n  const destino = await Destino.findByPk(destinoId);\r\n  await destino.update({ activo: false });\r\n  res.status(200).json({ message: \"Destino eliminado.\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\n/* // Si se quiere eliminar de la base de datos, se puede usar este método\r\n   //  pero es mejor usar un campo activo para no perder el historial de destinos.\r\nconst deleteDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.destroy({ where: { id: idDestino } });\r\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n*/\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}