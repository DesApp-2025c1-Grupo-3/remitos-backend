{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","controller","message","getDestino","req","res","destinos","findAll","activo","include","model","as","status","json","getDestinoById","destinoId","params","id","destino","findByPk","getDestinoFiltrado","name","pais","provincia","localidad","query","filtros","length","createDestino","body","nuevoDestino","create","createDestinoWithContacto","direccion","personaAutorizada","correoElectronico","telefono","destinoNuevo","nuevoContacto","destinoConContacto","updateDestino","idDestino","update","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst controller = {};\r\nconst { message } = require(\"../schemas/destinoSchema\");\r\n\r\nconst getDestino = async (req, res) => {\r\n  const destinos = await Destino.findAll({\r\n    where: { activo: true },\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const  destinoId  = req.params.id;\r\n  const destino = await Destino.findByPk(destinoId, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { name, pais, provincia, localidad } = req.query;\r\n  const filtros = {};                        //Solo permite letras y espacios\r\n  if (name) filtros.name = name;\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  filtros.activo = true; // Solo destinos activos\r\n  const destinos = await Destino.findAll({ where: filtros});\r\n  if (!destinos || destinos.length === 0) {\r\n    return res.status(404).json({\r\n      message: \"No se encontraron destinos con los filtros proporcionados.\",\r\n    });\r\n  }\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {     //Ver si es necesario dividir, en calle y altura, la dirección\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json({ message: \"Destino Creado\", nuevoDestino });\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const {\r\n    name,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n  } = req.body;\r\n\r\n  // Primero creo el destino\r\n  const destinoNuevo = await Destino.create({\r\n    name,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n  });\r\n\r\n  // Luego creo el contacto asociado\r\n  const nuevoContacto = await Contacto.create({\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n    destinoId: destinoNuevo.id,\r\n  });\r\n\r\n  // Traigo el destino con contactos para responder\r\n  const destinoConContacto = await Destino.findByPk(destinoNuevo.id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n\r\n  res.status(201).json({ message: \"Destino Creado con contacto\", destino: destinoConContacto, });\r\n};\r\n\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\n\r\n\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { name, pais, provincia, localidad, direccion } = req.body;\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ name, pais, provincia, localidad, direccion });\r\n  res.status(200).json({ message: \"Destino Actualizado\", destino });\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\n// Se elimina el destino marcándolo como inactivo, no se elimina de la base de datos.\r\nconst deleteDestino = async (req, res) => {\r\n  const destinoId = req.params.id;\r\n  const destino = await Destino.findByPk(destinoId);\r\n  await destino.update({ activo: false });\r\n  res.status(200).json({ message: \"Destino Eliminado\", destino });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}