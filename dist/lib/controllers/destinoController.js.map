{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","controller","getDestino","req","res","page","parseInt","params","limit","offset","count","rows","findAndCountAll","activo","include","model","as","order","status","json","totalItems","totalPages","Math","ceil","currentPage","data","getDestinoById","id","destinos","findByPk","getDestinoFiltrado","pais","provincia","localidad","query","filtros","findAll","createDestino","destino","body","nuevoDestino","create","createDestinoWithContacto","nombre","direccion","contactos","Array","isArray","length","message","nuevosContactos","Promise","all","map","contacto","clienteId","destinoConContacto","addContactoToDestino","idDestino","nuevoContacto","createContacto","clienteActualizado","error","console","updateDestino","update","activateDestino","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst controller = {};\r\n\r\nconst getDestino = async (req, res) => {\r\n  const page = parseInt(req.params.page) || 1;\r\n  const limit = parseInt(req.params.limit) || 20;\r\n  const offset = (page - 1) * limit; // permite saltear los que son de paginas anteriores\r\n  const { count, rows } = await Destino.findAndCountAll({\r\n    where: { activo: true },\r\n    include: { model: Contacto, as: \"contactos\" },\r\n    limit,\r\n    offset,\r\n    order: [[\"createdAt\", \"DESC\"]],\r\n  });\r\n  res.status(200).json({\r\n    totalItems: count,\r\n    totalPages: Math.ceil(count / limit),\r\n    currentPage: page,\r\n    data: rows,\r\n  });\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const destinos = await Destino.findByPk(id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { pais, provincia, localidad } = req.query;\r\n  const filtros = {};\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  const destinos = await Destino.findAll({ where: filtros });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json(nuevoDestino);\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const {\r\n    nombre,\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n    contactos\r\n  } = req.body;\r\n  const destino = await Destino.create({\r\n    nombre,pais,provincia,localidad,direccion});\r\n  if (!Array.isArray(contactos) || contactos.length === 0) {\r\n    return res.status(400).json({ message: \"Se requiere al menos un contacto.\" });\r\n  }\r\n  const nuevosContactos = await Promise.all(\r\n    contactos.map((contacto) =>\r\n      Contacto.create({ ...contacto, clienteId: destino.id })\r\n    )\r\n  );\r\n  const destinoConContacto = await Destino.findByPk(destino.id, {\r\n    include: {model: Contacto, as: \"contactos\"},\r\n  });\r\n  res.status(200).json(destinoConContacto);\r\n};\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\nconst addContactoToDestino = async (req, res) => {\r\n  try {\r\n    const idDestino = req.params.id\r\n    const nuevoContacto = req.body\r\n    const destino = await Destino.findByPk(idDestino)\r\n    await destino.createContacto(nuevoContacto)\r\n    const clienteActualizado = await Destino.findByPk(idDestino, { include: { model: Contacto, as: \"contactos\" } })\r\n    return res.status(200).json(clienteActualizado)\r\n  } catch (error) {\r\n    console.error(\"Error en cargar contacto:\", error)\r\n    return res.status(500).json({ message: \"Error al cargar contacto\" })\r\n  }\r\n}\r\ncontroller.addContactoToDestino = addContactoToDestino\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { pais, provincia, localidad, direccion } = req.body;\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ pais, provincia, localidad, direccion });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\nconst activateDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ activo: true });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.activateDestino = activateDestino;\r\n\r\nconst deleteDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ activo: false });\r\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}