{"version":3,"sources":["../../../lib/controllers/destinoController.js"],"names":["where","require","Destino","Contacto","message","controller","getDestino","req","res","destinos","findAll","activo","include","model","as","status","json","getDestinoById","id","params","getDestinoFiltrado","pais","provincia","localidad","query","filtros","createDestino","destino","body","nuevoDestino","create","createDestinoWithContacto","direccion","personaAutorizada","correoElectronico","telefono","nuevoContacto","destinoId","destinoConContacto","findByPk","updateDestino","idDestino","update","deleteDestino","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Destino, Contacto } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getDestino = async (req, res) => {\r\n  const destinos = await Destino.findAll({\r\n    where: { activo: true }, // Solo trae destinos activos\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestino = getDestino;\r\n\r\nconst getDestinoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const destinos = await Destino.findAll(id, {\r\n    include: { model: Contacto, as: \"contactos\" },\r\n  });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoById = getDestinoById;\r\n\r\nconst getDestinoFiltrado = async (req, res) => {\r\n  const { pais, provincia, localidad } = req.query;\r\n  const filtros = {};\r\n  if (pais) filtros.pais = pais;\r\n  if (provincia) filtros.provincia = provincia;\r\n  if (localidad) filtros.localidad = localidad;\r\n  const destinos = await Destino.findAll({ where: filtros });\r\n  res.status(200).json(destinos);\r\n};\r\ncontroller.getDestinoFiltrado = getDestinoFiltrado;\r\n\r\nconst createDestino = async (req, res) => {\r\n  const destino = req.body;\r\n  const nuevoDestino = await Destino.create(destino);\r\n  res.status(201).json(nuevoDestino);\r\n};\r\ncontroller.createDestino = createDestino;\r\n\r\nconst createDestinoWithContacto = async (req, res) => {\r\n  const {\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n  } = req.body;\r\n  const destino = await Destino.create({\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    direccion,\r\n  });\r\n  const nuevoContacto = await Contacto.create({\r\n    personaAutorizada,\r\n    correoElectronico,\r\n    telefono,\r\n    destinoId: destino.id,\r\n  });\r\n  const destinoConContacto = await Destino.findByPk(destino.id, {\r\n    include: {\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(destinoConContacto);\r\n};\r\ncontroller.createDestinoWithContacto = createDestinoWithContacto;\r\n\r\nconst updateDestino = async (req, res) => {\r\n  const { pais, provincia, localidad, direccion } = req.body;\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.findByPk(idDestino);\r\n  await destino.update({ pais, provincia, localidad, direccion });\r\n  res.status(200).json(destino);\r\n};\r\ncontroller.updateDestino = updateDestino;\r\n\r\n// Se elimina el destino marcándolo como inactivo, no se elimina de la base de datos.\r\nconst deleteDestino = async (req, res) => {\r\n  const destinoId = req.params.id;\r\n  const destino = await Destino.findByPk(destinoId);\r\n  await destino.update({ activo: false });\r\n  res.status(200).json({ message: \"Destino eliminado.\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n\r\n/* // Si se quiere eliminar de la base de datos, se puede usar este método\r\n   //  pero es mejor usar un campo activo para no perder el historial de destinos.\r\nconst deleteDestino = async (req, res) => {\r\n  const idDestino = req.params.id;\r\n  const destino = await Destino.destroy({ where: { id: idDestino } });\r\n  res.status(200).json({ message: \"Destino eliminado correctamente\" });\r\n};\r\ncontroller.deleteDestino = deleteDestino;\r\n*/\r\n\r\nmodule.exports = controller;\r\n"],"file":"destinoController.js"}