{"version":3,"sources":["../../../lib/controllers/clienteController.js"],"names":["where","require","Cliente","Contacto","message","controller","getCliente","req","res","clientes","findAll","include","activo","model","as","status","json","getClienteById","id","params","cliente","findByPk","createCliente","body","nuevoCliente","create","createClienteWithContacto","contacto","razonSocial","cuit_rut","direccion","tipoEmpresa","nuevoContacto","personaAutorizada","correoElectronico","telefono","clienteId","clienteConContacto","error","console","updateCliente","idCliente","update","deleteCliente","module","exports"],"mappings":"AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAYC,OAAO,CAAC,WAAD,CAAzB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAcD,OAAO,CAAC,WAAD,CAA3B;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAeF,OAAO,CAAC,WAAD,CAA5B;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAcH,OAAO,CAAC,yBAAD,CAA3B;;AACA,MAAMI,UAAU,GAAG,EAAnB;;AAEA,MAAMC,UAAU,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACrC,QAAMC,QAAQ,GAAG,MAAMP,OAAO,CAACQ,OAAR,CAAgB;AACrCC,IAAAA,OAAO,EAAE;AACPX,MAAAA,KAAK,EAAE;AAAEY,QAAAA,MAAM,EAAE;AAAV,OADA;AACkB;AACzBC,MAAAA,KAAK,EAAEV,QAFA;AAGPW,MAAAA,EAAE,EAAE;AAHG;AAD4B,GAAhB,CAAvB;AAOAN,EAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBP,QAArB;AACD,CATD;;AAUAJ,UAAU,CAACC,UAAX,GAAwBA,UAAxB;;AAEA,MAAMW,cAAc,GAAG,OAAOV,GAAP,EAAYC,GAAZ,KAAoB;AACzC,QAAMU,EAAE,GAAGX,GAAG,CAACY,MAAJ,CAAWD,EAAtB;AACA,QAAME,OAAO,GAAG,MAAMlB,OAAO,CAACmB,QAAR,CAAiBH,EAAjB,EAAqB;AACzCP,IAAAA,OAAO,EAAE;AACPE,MAAAA,KAAK,EAAEV,QADA;AAEPW,MAAAA,EAAE,EAAE;AAFG;AADgC,GAArB,CAAtB;AAMAN,EAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,OAArB;AACD,CATD;;AAUAf,UAAU,CAACY,cAAX,GAA4BA,cAA5B;;AAEA,MAAMK,aAAa,GAAG,OAAOf,GAAP,EAAYC,GAAZ,KAAoB;AACxC,QAAMY,OAAO,GAAGb,GAAG,CAACgB,IAApB;AACA,QAAMC,YAAY,GAAG,MAAMtB,OAAO,CAACuB,MAAR,CAAeL,OAAf,CAA3B;AACAZ,EAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEZ,IAAAA,OAAO,EAAE,gBAAX;AAA6BoB,IAAAA;AAA7B,GAArB;AACD,CAJD;;AAMAnB,UAAU,CAACiB,aAAX,GAA2BA,aAA3B;;AAGA,MAAMI,yBAAyB,GAAG,OAAOnB,GAAP,EAAYC,GAAZ,KAAoB;AACpD,MAAI;AACF,UAAM;AAAEY,MAAAA,OAAF;AAAWO,MAAAA;AAAX,QAAwBpB,GAAG,CAACgB,IAAlC,CADE,CAGF;;AACA,UAAMC,YAAY,GAAG,MAAMtB,OAAO,CAACuB,MAAR,CAAe;AACxCG,MAAAA,WAAW,EAAER,OAAO,CAACQ,WADmB;AAExCC,MAAAA,QAAQ,EAAET,OAAO,CAACS,QAFsB;AAGxCC,MAAAA,SAAS,EAAEV,OAAO,CAACU,SAHqB;AAIxCC,MAAAA,WAAW,EAAEX,OAAO,CAACW;AAJmB,KAAf,CAA3B,CAJE,CAWF;;AACA,UAAMC,aAAa,GAAG,MAAM7B,QAAQ,CAACsB,MAAT,CAAgB;AAC1CQ,MAAAA,iBAAiB,EAAEN,QAAQ,CAACM,iBADc;AAE1CC,MAAAA,iBAAiB,EAAEP,QAAQ,CAACO,iBAFc;AAG1CC,MAAAA,QAAQ,EAAER,QAAQ,CAACQ,QAHuB;AAI1CC,MAAAA,SAAS,EAAEZ,YAAY,CAACN,EAJkB,CAIf;;AAJe,KAAhB,CAA5B,CAZE,CAmBF;;AACA,UAAMmB,kBAAkB,GAAG,MAAMnC,OAAO,CAACmB,QAAR,CAAiBG,YAAY,CAACN,EAA9B,EAAkC;AACjEP,MAAAA,OAAO,EAAE;AAAEE,QAAAA,KAAK,EAAEV,QAAT;AAAmBW,QAAAA,EAAE,EAAE;AAAvB,OADwD,CACnB;;AADmB,KAAlC,CAAjC;AAIAN,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBZ,MAAAA,OAAO,EAAE,sCADU;AAEnBgB,MAAAA,OAAO,EAAEiB;AAFU,KAArB;AAID,GA5BD,CA4BE,OAAOC,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACD,KAAR,CAAc,sCAAd,EAAsDA,KAAtD;AACA9B,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEsB,MAAAA,KAAK,EAAE;AAAT,KAArB;AACD;AACF,CAjCD;;AAmCAjC,UAAU,CAACqB,yBAAX,GAAuCA,yBAAvC;;AAEA,MAAMc,aAAa,GAAG,OAAOjC,GAAP,EAAYC,GAAZ,KAAoB;AACxC,QAAMiC,SAAS,GAAGlC,GAAG,CAACY,MAAJ,CAAWD,EAA7B;AACA,QAAM;AAAEU,IAAAA,WAAF;AAAeC,IAAAA,QAAf;AAAyBC,IAAAA,SAAzB;AAAoCC,IAAAA;AAApC,MAAoDxB,GAAG,CAACgB,IAA9D;AACA,QAAMH,OAAO,GAAG,MAAMlB,OAAO,CAACmB,QAAR,CAAiBoB,SAAjB,CAAtB;AACA,QAAMrB,OAAO,CAACsB,MAAR,CAAe;AAAEd,IAAAA,WAAF;AAAeC,IAAAA,QAAf;AAAyBC,IAAAA,SAAzB;AAAoCC,IAAAA;AAApC,GAAf,CAAN;AACAvB,EAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBI,OAArB;AACD,CAND;;AAOAf,UAAU,CAACmC,aAAX,GAA2BA,aAA3B,C,CAEA;;AACA,MAAMG,aAAa,GAAG,OAAOpC,GAAP,EAAYC,GAAZ,KAAoB;AACxC,QAAM4B,SAAS,GAAG7B,GAAG,CAACY,MAAJ,CAAWD,EAA7B;AACA,QAAME,OAAO,GAAG,MAAMlB,OAAO,CAACmB,QAAR,CAAiBe,SAAjB,CAAtB;AACA,QAAMhB,OAAO,CAACsB,MAAR,CAAe;AAAE9B,IAAAA,MAAM,EAAE;AAAV,GAAf,CAAN;AACAJ,EAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEZ,IAAAA,OAAO,EAAE,oBAAX;AAAiCgB,IAAAA;AAAjC,GAArB;AACD,CALD;;AAMAf,UAAU,CAACsC,aAAX,GAA2BA,aAA3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAC,MAAM,CAACC,OAAP,GAAiBxC,UAAjB","sourcesContent":["const { where } = require(\"sequelize\");\r\nconst { Cliente } = require(\"../models\");\r\nconst { Contacto } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getCliente = async (req, res) => {\r\n  const clientes = await Cliente.findAll({\r\n    include: {\r\n      where: { activo: true }, // Solo clientes activos\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(clientes);\r\n};\r\ncontroller.getCliente = getCliente;\r\n\r\nconst getClienteById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const cliente = await Cliente.findByPk(id, {\r\n    include: {\r\n      model: Contacto,\r\n      as: \"contactos\",\r\n    },\r\n  });\r\n  res.status(200).json(cliente);\r\n};\r\ncontroller.getClienteById = getClienteById;\r\n\r\nconst createCliente = async (req, res) => {\r\n  const cliente = req.body;\r\n  const nuevoCliente = await Cliente.create(cliente);\r\n  res.status(201).json({ message: \"Cliente Creado\", nuevoCliente });\r\n};\r\n\r\ncontroller.createCliente = createCliente;\r\n\r\n\r\nconst createClienteWithContacto = async (req, res) => {\r\n  try {\r\n    const { cliente, contacto } = req.body;\r\n\r\n    // Crear cliente\r\n    const nuevoCliente = await Cliente.create({\r\n      razonSocial: cliente.razonSocial,\r\n      cuit_rut: cliente.cuit_rut,\r\n      direccion: cliente.direccion,\r\n      tipoEmpresa: cliente.tipoEmpresa\r\n    });\r\n\r\n    // Crear contacto asociado\r\n    const nuevoContacto = await Contacto.create({\r\n      personaAutorizada: contacto.personaAutorizada,\r\n      correoElectronico: contacto.correoElectronico,\r\n      telefono: contacto.telefono,\r\n      clienteId: nuevoCliente.id // FK\r\n    });\r\n\r\n    // Traer el cliente con su contacto para responder\r\n    const clienteConContacto = await Cliente.findByPk(nuevoCliente.id, {\r\n      include: { model: Contacto, as: 'contactos' } // Asegurate de que el alias 'contactos' esté bien definido en la asociación\r\n    });\r\n\r\n    res.status(201).json({\r\n      message: 'Cliente creado con contacto asociado',\r\n      cliente: clienteConContacto\r\n    });\r\n  } catch (error) {\r\n    console.error('Error al crear cliente con contacto:', error);\r\n    res.status(500).json({ error: 'Ocurrió un error al crear el cliente y el contacto' });\r\n  }\r\n};\r\n\r\ncontroller.createClienteWithContacto = createClienteWithContacto;\r\n\r\nconst updateCliente = async (req, res) => {\r\n  const idCliente = req.params.id;\r\n  const { razonSocial, cuit_rut, direccion, tipoEmpresa } = req.body;\r\n  const cliente = await Cliente.findByPk(idCliente);\r\n  await cliente.update({ razonSocial, cuit_rut, direccion, tipoEmpresa });\r\n  res.status(200).json(cliente);\r\n};\r\ncontroller.updateCliente = updateCliente;\r\n\r\n// Se elimina el cliente marcándolo como inactivo, no se elimina de la base de datos.\r\nconst deleteCliente = async (req, res) => {\r\n  const clienteId = req.params.id;\r\n  const cliente = await Cliente.findByPk(clienteId);\r\n  await cliente.update({ activo: false }); \r\n  res.status(200).json({ message: \"Cliente eliminado.\", cliente });\r\n}\r\ncontroller.deleteCliente = deleteCliente;\r\n\r\n/* // Si se quiere eliminar de la base de datos, se puede usar este método\r\n   //  pero es mejor usar un campo activo para no perder el historial de clientes.\r\nconst deleteCliente = async (req, res) => {\r\n  const idCliente = req.params.id;\r\n  const cliente = await Cliente.destroy({ where: { id: idCliente } });\r\n  res.status(200).json({ message: \"Cliente eliminado correctamente\" });\r\n};\r\ncontroller.deleteCliente = deleteCliente;\r\n*/\r\n\r\nmodule.exports = controller;\r\n"],"file":"clienteController.js"}