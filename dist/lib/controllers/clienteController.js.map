{"version":3,"sources":["../../../lib/controllers/clienteController.js"],"names":["Cliente","Contacto","require","cliente","controller","getCliente","req","res","page","parseInt","query","limit","cacheKey","offset","count","rows","findAndCountAll","where","activo","include","model","as","order","responseData","totalItems","totalPages","Math","ceil","currentPage","data","set","JSON","stringify","status","json","error","console","message","getClienteById","id","params","clienteData","cacheClienteId","get","parse","clienteDB","findByPk","createCliente","clienteNuevo","body","nuevoCliente","create","del","createClienteWithContacto","razonSocial","cuit_rut","direccion","tipoEmpresa","contactos","newCliente","Array","isArray","length","nuevosContactos","Promise","all","map","contacto","clienteId","clienteConContactos","addContactoToCliente","idCliente","createContacto","clienteActualizado","deleteCliente","clienteToDelete","update","activateCliente","clienteToActivate","updateCliente","clienteToUpdate","module","exports"],"mappings":"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","sourcesContent":["const { Cliente, Contacto } = require(\"../models\");\nconst cliente = require(\"../config/redis\");\nconst controller = {};\n\nconst getCliente = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const cacheKey = `clientes:page:${page}:limit:${limit}`;\n    /*const cacheCliente = await cliente.get(cacheKey);\n    if (cacheCliente) {\n      return res.status(200).json(JSON.parse(cacheCliente));\n      BUSCAR SOLUCION A LA CACHÃ‰\n    }*/\n    const offset = (page - 1) * limit;\n    const { count, rows } = await Cliente.findAndCountAll({\n      where: { activo: true },\n      include: {\n        model: Contacto,\n        as: \"contactos\",\n      },\n      limit,\n      offset,\n      order: [[\"createdAt\", \"DESC\"]],\n    });\n    const responseData = {\n      totalItems: count,\n      totalPages: Math.ceil(count / limit),\n      currentPage: page,\n      data: rows,\n    };\n    await cliente.set(cacheKey, JSON.stringify(responseData), \"EX\", 5000);\n    return res.status(200).json(responseData);\n  } catch (error) {\n    console.error(\"Error en getCliente:\", error);\n    return res\n      .status(500)\n      .json({ message: \"Error interno del servidor al obtener clientes.\" });\n  }\n};\ncontroller.getCliente = getCliente;\n\nconst getClienteById = async (req, res) => {\n  const id = req.params.id;\n  let clienteData;\n\n  try {\n    const cacheClienteId = await cliente.get(`cliente${id}`);\n\n    if (cacheClienteId) {\n      clienteData = JSON.parse(cacheClienteId);\n    } else {\n      const clienteDB = await Cliente.findByPk(id, {\n        include: {\n          model: Contacto,\n          as: \"contactos\",\n        },\n      });\n\n      clienteData = clienteDB;\n\n      await cliente.set(\n        `cliente${id}`,\n        JSON.stringify(clienteData),\n        \"EX\",\n        5000\n      );\n    }\n\n    return res.status(200).json(clienteData);\n  } catch (error) {\n    console.error(\"Error en getClienteById:\", error);\n    return res.status(500).json({ message: \"Error interno del servidor.\" });\n  }\n};\ncontroller.getClienteById = getClienteById;\n\nconst createCliente = async (req, res) => {\n  try {\n    const clienteNuevo = req.body;\n    const nuevoCliente = await Cliente.create(clienteNuevo);\n\n    await cliente.del(`clientes:*`);\n\n    return res.status(201).json(nuevoCliente);\n  } catch (error) {\n    console.error(\"Error en createCliente:\", error);\n    return res\n      .status(500)\n      .json({ message: \"Error interno del servidor al crear cliente.\" });\n  }\n};\ncontroller.createCliente = createCliente;\n\nconst createClienteWithContacto = async (req, res) => {\n  try {\n    const {\n      razonSocial,\n      cuit_rut,\n      direccion,\n      tipoEmpresa,\n      contactos,\n    } = req.body;\n    const newCliente = await Cliente.create({\n      razonSocial,\n      cuit_rut,\n      direccion,\n      tipoEmpresa,\n    });\n    if (!Array.isArray(contactos) || contactos.length === 0) {\n      return res\n        .status(400)\n        .json({ message: \"Se requiere al menos un contacto.\" });\n    }\n    const nuevosContactos = await Promise.all(\n      contactos.map((contacto) =>\n        Contacto.create({ ...contacto, clienteId: newCliente.id })\n      )\n    );\n    const clienteConContactos = await Cliente.findByPk(newCliente.id, {\n      include: { model: Contacto, as: \"contactos\" },\n    });\n    await cliente.del(`clientes:*`);\n    const page = 1;\n    const limit = 20;\n    const offset = (page - 1) * limit;\n    const cacheKey = `clientes:page:${page}:limit:${limit}`;\n\n    const { count, rows } = await Cliente.findAndCountAll({\n      where: { activo: true },\n      include: { model: Contacto, as: \"contactos\" },\n      limit,\n      offset,\n      order: [[\"createdAt\", \"DESC\"]],\n    });\n\n    const responseData = {\n      totalItems: count,\n      totalPages: Math.ceil(count / limit),\n      currentPage: page,\n      data: rows,\n    };\n\n    await cliente.set(cacheKey, JSON.stringify(responseData), \"EX\", 5000);\n    return res.status(200).json(clienteConContactos);\n  } catch (error) {\n    console.error(\"Error en createClienteWithContacto:\", error);\n    return res.status(500).json({\n      message: \"Error interno del servidor al crear cliente con contactos.\",\n    });\n  }\n};\n\ncontroller.createClienteWithContacto = createClienteWithContacto;\n\nconst addContactoToCliente = async (req, res) => {\n  try {\n    const idCliente = req.params.id;\n    const nuevoCliente = req.body;\n    const cliente = await Cliente.findByPk(idCliente);\n    await cliente.createContacto(nuevoCliente);\n    const clienteActualizado = await Cliente.findByPk(idCliente, {\n      include: { model: Contacto, as: \"contactos\" },\n    });\n    await cliente.set(\n      `cliente${idCliente}`,\n      JSON.stringify(clienteActualizado),\n      \"EX\",\n      5000\n    );\n    return res.status(200).json(clienteActualizado);\n  } catch (error) {\n    console.error(\"Error en cargar contacto:\", error);\n    return res.status(500).json({ message: \"Error al cargar contacto\" });\n  }\n};\ncontroller.addContactoToCliente = addContactoToCliente;\n\nconst deleteCliente = async (req, res) => {\n  try {\n    const idCliente = req.params.id;\n    const clienteToDelete = await Cliente.findByPk(idCliente);\n\n    await clienteToDelete.update({ activo: false });\n\n    await cliente.del(`cliente${idCliente}`);\n    await cliente.del(`clientes:*`);\n\n    return res.status(200).json({ message: \"Cliente eliminado correctamente\" });\n  } catch (error) {\n    console.error(\"Error en deleteCliente:\", error);\n    return res\n      .status(500)\n      .json({ message: \"Error interno del servidor al eliminar cliente.\" });\n  }\n};\ncontroller.deleteCliente = deleteCliente;\n\nconst activateCliente = async (req, res) => {\n  try {\n    const idCliente = req.params.id;\n    const clienteToActivate = await Cliente.findByPk(idCliente);\n\n    await clienteToActivate.update({ activo: true });\n\n    await cliente.del(`cliente${idCliente}`);\n    await cliente.del(`clientes:*`);\n\n    return res.status(200).json(clienteToActivate);\n  } catch (error) {\n    console.error(\"Error en activateCliente:\", error);\n    return res\n      .status(500)\n      .json({ message: \"Error interno del servidor al activar cliente.\" });\n  }\n};\ncontroller.activateCliente = activateCliente;\n\nconst updateCliente = async (req, res) => {\n  try {\n    const idCliente = req.params.id;\n    const { razonSocial, cuit_rut, direccion, tipoEmpresa } = req.body;\n    const clienteToUpdate = await Cliente.findByPk(idCliente);\n\n    await clienteToUpdate.update({\n      razonSocial,\n      cuit_rut,\n      direccion,\n      tipoEmpresa,\n    });\n\n    await cliente.del(`cliente${idCliente}`);\n    await cliente.del(`clientes:*`);\n\n    return res.status(200).json(clienteToUpdate);\n  } catch (error) {\n    console.error(\"Error en updateCliente:\", error);\n    return res\n      .status(500)\n      .json({ error: \"Error del servidor al actualizar cliente.\" });\n  }\n};\ncontroller.updateCliente = updateCliente;\n\nmodule.exports = controller;\n"],"file":"clienteController.js"}