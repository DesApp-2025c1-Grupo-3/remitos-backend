{"version":3,"sources":["../../../lib/controllers/clienteController.js"],"names":["where","require","Cliente","Contacto","message","controller","getCliente","req","res","page","parseInt","params","limit","offset","count","rows","findAndCountAll","activo","include","model","as","order","status","json","totalItems","totalPages","Math","ceil","currentPage","data","getClienteById","id","cliente","findByPk","createCliente","body","nuevoCliente","create","createClienteWithContacto","razonSocial","cuit_rut","direccion","tipoEmpresa","personaAutorizada","correoElectronico","telefono","nuevoContacto","clienteId","clienteConContactos","deleteCliente","idCliente","update","activateCliente","updateCliente","module","exports"],"mappings":"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","sourcesContent":["const { where } = require(\"sequelize\");\nconst { Cliente } = require(\"../models\");\nconst { Contacto } = require(\"../models\");\nconst { message } = require(\"../schemas/estadoSchema\");\nconst controller = {};\n\nconst getCliente = async (req, res) => {\n  const page = parseInt(req.params.page) || 1;\n  const limit = parseInt(req.params.limit) || 20;\n  const offset = (page - 1) * limit; // permite saltear los que son de paginas anteriores\n  const { count, rows } = await Cliente.findAndCountAll({\n    where: { activo: true },\n    include: {\n      model: Contacto,\n      as: \"contactos\",\n    },\n    limit,\n    offset,\n    order: [[\"createdAt\", \"DESC\"]],\n  });\n  res.status(200).json({\n    totalItems: count,\n    totalPages: Math.ceil(count / limit),\n    currentPage: page,\n    data: rows,\n  });\n};\ncontroller.getCliente = getCliente;\n\nconst getClienteById = async (req, res) => {\n  const id = req.params.id;\n  const cliente = await Cliente.findByPk(id, {\n    include: {\n      model: Contacto,\n      as: \"contactos\",\n    },\n  });\n  res.status(200).json(cliente);\n};\ncontroller.getClienteById = getClienteById;\n\nconst createCliente = async (req, res) => {\n  const cliente = req.body;\n  const nuevoCliente = await Cliente.create(cliente);\n  res.status(201).json(nuevoCliente);\n};\n\ncontroller.createCliente = createCliente;\n\nconst createClienteWithContacto = async (req, res) => {\n  const {\n    razonSocial,\n    cuit_rut,\n    direccion,\n    tipoEmpresa,\n    personaAutorizada,\n    correoElectronico,\n    telefono,\n  } = req.body;\n  const cliente = await Cliente.create({\n    razonSocial,\n    cuit_rut,\n    direccion,\n    tipoEmpresa,\n  });\n  const nuevoContacto = await Contacto.create({\n    personaAutorizada,\n    correoElectronico,\n    telefono,\n    clienteId: cliente.id,\n  });\n  const clienteConContactos = await Cliente.findByPk(cliente.id, {\n    include: {\n      model: Contacto,\n      as: \"contactos\",\n    },\n  });\n  res.status(200).json(clienteConContactos);\n};\ncontroller.createClienteWithContacto = createClienteWithContacto;\n\nconst deleteCliente = async (req, res) => {\n  const idCliente = req.params.id;\n  const cliente = await Cliente.findByPk(idCliente);\n  await cliente.update({ activo: false });\n  res.status(200).json({ message: \"Cliente eliminado correctamente\" });\n};\ncontroller.deleteCliente = deleteCliente;\n\nconst activateCliente = async (req, res) => {\n  const idCliente = req.params.id;\n  const cliente = await Cliente.findByPk(idCliente);\n  await cliente.update({ activo: true });\n  res.status(200).json(cliente);\n};\ncontroller.activateCliente = activateCliente;\n\nconst updateCliente = async (req, res) => {\n  const idCliente = req.params.id;\n  const { razonSocial, cuit_rut, direccion, tipoEmpresa } = req.body;\n  const cliente = await Cliente.findByPk(idCliente);\n  await cliente.update({ razonSocial, cuit_rut, direccion, tipoEmpresa });\n  res.status(200).json(cliente);\n};\n\ncontroller.updateCliente = updateCliente;\n\nmodule.exports = controller;\n"],"file":"clienteController.js"}