{"version":3,"sources":["../../../lib/controllers/reportesController.js"],"names":["Remito","Cliente","Destino","Mercaderia","sequelize","require","Op","controller","getVolumenPorClientePeriodo","req","res","clienteId","fechaDesde","fechaHasta","query","where","fechaEmision","between","gte","lte","remitos","findAll","include","model","as","resultado","forEach","remito","cliente","razonSocial","volumen","mercaderia","volumenMetrosCubico","data","Object","entries","map","volumenTotal","json","error","console","status","getDistribucionGeografica","pais","provincia","localidad","tipo","paisVal","provinciaVal","localidadVal","origen","destino","nombre","key","cantidad","values","getValorPorTipoMercaderia","tipos","whereRemito","whereMercaderia","tiposArray","Array","isArray","split","t","trim","length","tipoMercaderia","in","keys","undefined","valor","Number","valorDeclarado","valorTotal","module","exports"],"mappings":"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","sourcesContent":["const {\r\n  Remito,\r\n  Cliente,\r\n  Destino,\r\n  Mercaderia,\r\n  sequelize,\r\n} = require(\"../models\");\r\nconst { Op } = require(\"sequelize\");\r\nconst controller = {};\r\n\r\n// 1. Volumen total de mercadería por cliente/período\r\ncontroller.getVolumenPorClientePeriodo = async (req, res) => {\r\n  const { clienteId, fechaDesde, fechaHasta } = req.query;\r\n  try {\r\n    const where = {};\r\n    if (clienteId) where.clienteId = clienteId;\r\n    if (fechaDesde && fechaHasta) {\r\n      where.fechaEmision = { [Op.between]: [fechaDesde, fechaHasta] };\r\n    } else if (fechaDesde) {\r\n      where.fechaEmision = { [Op.gte]: fechaDesde };\r\n    } else if (fechaHasta) {\r\n      where.fechaEmision = { [Op.lte]: fechaHasta };\r\n    }\r\n    const remitos = await Remito.findAll({\r\n      where,\r\n      include: [\r\n        { model: Mercaderia, as: \"mercaderia\" },\r\n        { model: Cliente, as: \"cliente\" },\r\n      ],\r\n    });\r\n    const resultado = {};\r\n    remitos.forEach((remito) => {\r\n      const cliente = remito.cliente;\r\n      const razonSocial = cliente ? cliente.razonSocial : \"Sin cliente\";\r\n      const volumen = remito.mercaderia\r\n        ? remito.mercaderia.volumenMetrosCubico\r\n        : 0;\r\n      if (!resultado[razonSocial]) resultado[razonSocial] = 0;\r\n      resultado[razonSocial] += volumen;\r\n    });\r\n    const data = Object.entries(resultado).map(([cliente, volumenTotal]) => ({\r\n      cliente,\r\n      volumenTotal,\r\n    }));\r\n    res.json(data);\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).json({\r\n      error: \"Error al obtener el reporte de volumen por cliente/período\",\r\n    });\r\n  }\r\n};\r\n\r\n// 2. Distribución geográfica de orígenes y destinos\r\ncontroller.getDistribucionGeografica = async (req, res) => {\r\n  const {\r\n    pais,\r\n    provincia,\r\n    localidad,\r\n    tipo,\r\n    clienteId,\r\n    fechaDesde,\r\n    fechaHasta,\r\n  } = req.query;\r\n  try {\r\n    const where = {};\r\n    if (clienteId) where.clienteId = clienteId;\r\n    if (fechaDesde && fechaHasta) {\r\n      where.fechaEmision = { [Op.between]: [fechaDesde, fechaHasta] };\r\n    } else if (fechaDesde) {\r\n      where.fechaEmision = { [Op.gte]: fechaDesde };\r\n    } else if (fechaHasta) {\r\n      where.fechaEmision = { [Op.lte]: fechaHasta };\r\n    }\r\n    const include = [\r\n      { model: Destino, as: \"destino\" },\r\n      { model: Cliente, as: \"cliente\" },\r\n    ];\r\n    const remitos = await Remito.findAll({ where, include });\r\n    // Agrupar por país, provincia, localidad, origen/destino\r\n    const resultado = {};\r\n    remitos.forEach((remito) => {\r\n      let paisVal = \"-\",\r\n        provinciaVal = \"-\",\r\n        localidadVal = \"-\",\r\n        origen = \"-\",\r\n        destino = \"-\";\r\n      if (tipo === \"origen\") {\r\n        origen = remito.cliente ? remito.cliente.razonSocial : \"Sin cliente\";\r\n        paisVal =\r\n          remito.cliente && remito.cliente.pais ? remito.cliente.pais : \"-\";\r\n        provinciaVal =\r\n          remito.cliente && remito.cliente.provincia\r\n            ? remito.cliente.provincia\r\n            : \"-\";\r\n        localidadVal =\r\n          remito.cliente && remito.cliente.localidad\r\n            ? remito.cliente.localidad\r\n            : \"-\";\r\n      } else {\r\n        destino = remito.destino ? remito.destino.nombre : \"Sin destino\";\r\n        paisVal =\r\n          remito.destino && remito.destino.pais ? remito.destino.pais : \"-\";\r\n        provinciaVal =\r\n          remito.destino && remito.destino.provincia\r\n            ? remito.destino.provincia\r\n            : \"-\";\r\n        localidadVal =\r\n          remito.destino && remito.destino.localidad\r\n            ? remito.destino.localidad\r\n            : \"-\";\r\n      }\r\n      // Filtros\r\n      if (pais && paisVal !== pais) return;\r\n      if (provincia && provinciaVal !== provincia) return;\r\n      if (localidad && localidadVal !== localidad) return;\r\n      const key = `${paisVal}|${provinciaVal}|${localidadVal}|${origen}|${destino}`;\r\n      if (!resultado[key])\r\n        resultado[key] = {\r\n          pais: paisVal,\r\n          provincia: provinciaVal,\r\n          localidad: localidadVal,\r\n          origen,\r\n          destino,\r\n          cantidad: 0,\r\n        };\r\n      resultado[key].cantidad += 1;\r\n    });\r\n    const data = Object.values(resultado);\r\n    res.json(data);\r\n  } catch (error) {\r\n    console.error(error);\r\n    res\r\n      .status(500)\r\n      .json({ error: \"Error al obtener la distribución geográfica\" });\r\n  }\r\n};\r\n\r\n// 3. Valor declarado por tipo de mercadería\r\ncontroller.getValorPorTipoMercaderia = async (req, res) => {\r\n  const { clienteId, fechaDesde, fechaHasta, tipos } = req.query;\r\n  try {\r\n    const whereRemito = {};\r\n    if (clienteId) whereRemito.clienteId = clienteId;\r\n    if (fechaDesde && fechaHasta) {\r\n      whereRemito.fechaEmision = { [Op.between]: [fechaDesde, fechaHasta] };\r\n    } else if (fechaDesde) {\r\n      whereRemito.fechaEmision = { [Op.gte]: fechaDesde };\r\n    } else if (fechaHasta) {\r\n      whereRemito.fechaEmision = { [Op.lte]: fechaHasta };\r\n    }\r\n\r\n    // Configurar filtro para mercadería si se especifican tipos\r\n    const whereMercaderia = {};\r\n    let tiposArray = [];\r\n\r\n    // Manejar diferentes formatos del parámetro tipos\r\n    if (tipos) {\r\n      if (Array.isArray(tipos)) {\r\n        tiposArray = tipos;\r\n      } else if (typeof tipos === \"string\") {\r\n        // Si es un string, podría ser un solo valor o valores separados por coma\r\n        tiposArray = tipos.split(\",\").map((t) => t.trim());\r\n      } else if (typeof tipos === \"object\") {\r\n        // Si es un objeto (caso de Express con parámetros múltiples)\r\n        tiposArray = Object.values(tipos);\r\n      }\r\n    }\r\n\r\n    if (tiposArray.length > 0) {\r\n      whereMercaderia.tipoMercaderia = { [Op.in]: tiposArray };\r\n    }\r\n\r\n    const remitos = await Remito.findAll({\r\n      where: whereRemito,\r\n      include: [\r\n        {\r\n          model: Mercaderia,\r\n          as: \"mercaderia\",\r\n          where:\r\n            Object.keys(whereMercaderia).length > 0\r\n              ? whereMercaderia\r\n              : undefined,\r\n        },\r\n      ],\r\n    });\r\n\r\n    // Agrupar por tipo de mercadería\r\n    const resultado = {};\r\n    remitos.forEach((remito) => {\r\n      const tipo = remito.mercaderia\r\n        ? remito.mercaderia.tipoMercaderia\r\n        : \"Sin tipo\";\r\n      const valor = remito.mercaderia\r\n        ? Number(remito.mercaderia.valorDeclarado)\r\n        : 0;\r\n      if (!resultado[tipo]) resultado[tipo] = 0;\r\n      resultado[tipo] += valor;\r\n    });\r\n    const data = Object.entries(resultado).map(([tipo, valorTotal]) => ({\r\n      tipo,\r\n      valorTotal,\r\n    }));\r\n    res.json(data);\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).json({\r\n      error: \"Error al obtener el valor declarado por tipo de mercadería\",\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = controller;\r\n"],"file":"reportesController.js"}