{"version":3,"sources":["../../../lib/controllers/remitoController.js"],"names":["includes","require","Remito","Cliente","Destino","Mercaderia","Estado","message","off","controller","getRemitos","req","res","page","parseInt","params","limit","offset","count","rows","findAndCountAll","where","activo","include","model","as","order","status","json","totalItems","totalPages","Math","ceil","currentPage","data","getRemitoById","id","remito","findByPk","createRemito","numeroAsignado","observaciones","prioridad","tipoMercaderia","valorDeclarado","volumenMetrosCubico","pesoMercaderia","cantidadBobinas","cantidadRacks","cantidadBultos","cantidadPallets","requisitosEspeciales","body","fechaEmision","Date","archivoEnviado","file","path","create","archivoAdjunto","mercaderia","remitosId","createRemitoWithClienteAndDestino","clienteId","destinoId","mercaderiaId","estadoId","remitoWithDestinoAndCliente","update","updateRemito","idRemito","updateEstadoRemito","remitoId","estId","eid","remitoActualizado","deleteRemito","activateRemito","module","exports"],"mappings":"AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAeC,OAAO,CAAC,QAAD,CAA5B;;AACA,MAAM;AAAEC,EAAAA,MAAF;AAAUC,EAAAA,OAAV;AAAmBC,EAAAA,OAAnB;AAA4BC,EAAAA,UAA5B;AAAwCC,EAAAA;AAAxC,IAAmDL,OAAO,CAAC,WAAD,CAAhE;;AACA,MAAM;AAAEM,EAAAA;AAAF,IAAcN,OAAO,CAAC,yBAAD,CAA3B;;AACA,MAAM;AAAEO,EAAAA;AAAF,IAAUP,OAAO,CAAC,QAAD,CAAvB;;AACA,MAAMQ,UAAU,GAAG,EAAnB;;AAEA,MAAMC,UAAU,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACrC,QAAMC,IAAI,GAAGC,QAAQ,CAACH,GAAG,CAACI,MAAJ,CAAWF,IAAZ,CAAR,IAA6B,CAA1C;AACA,QAAMG,KAAK,GAAGF,QAAQ,CAACH,GAAG,CAACI,MAAJ,CAAWC,KAAZ,CAAR,IAA8B,EAA5C;AACA,QAAMC,MAAM,GAAG,CAACJ,IAAI,GAAG,CAAR,IAAaG,KAA5B,CAHqC,CAGF;;AACnC,QAAM;AAAEE,IAAAA,KAAF;AAASC,IAAAA;AAAT,MAAkB,MAAMjB,MAAM,CAACkB,eAAP,CAAuB;AACnDC,IAAAA,KAAK,EAAE;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAD4C;AAEnDC,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,KAAK,EAAEpB,OADT;AAEEqB,MAAAA,EAAE,EAAE;AAFN,KADO,EAKP;AACED,MAAAA,KAAK,EAAErB,OADT;AAEEsB,MAAAA,EAAE,EAAE;AAFN,KALO,EASP;AACED,MAAAA,KAAK,EAAElB,MADT;AAEEmB,MAAAA,EAAE,EAAE;AAFN,KATO,EAaP;AACED,MAAAA,KAAK,EAAEnB,UADT;AAEEoB,MAAAA,EAAE,EAAE;AAFN,KAbO,CAF0C;AAoBnDT,IAAAA,KApBmD;AAqBnDC,IAAAA,MArBmD;AAsBnDS,IAAAA,KAAK,EAAE,CAAC,CAAC,WAAD,EAAc,MAAd,CAAD,CAtB4C,CAsBnB;;AAtBmB,GAAvB,CAA9B;AAwBAd,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,IAAAA,UAAU,EAAEX,KADO;AAEnBY,IAAAA,UAAU,EAAEC,IAAI,CAACC,IAAL,CAAUd,KAAK,GAAGF,KAAlB,CAFO;AAGnBiB,IAAAA,WAAW,EAAEpB,IAHM;AAInBqB,IAAAA,IAAI,EAAEf;AAJa,GAArB;AAMD,CAlCD;;AAmCAV,UAAU,CAACC,UAAX,GAAwBA,UAAxB;;AAEA,MAAMyB,aAAa,GAAG,OAAOxB,GAAP,EAAYC,GAAZ,KAAoB;AACxC,QAAMwB,EAAE,GAAGzB,GAAG,CAACI,MAAJ,CAAWqB,EAAtB;AACA,QAAMC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,QAAP,CAAgBF,EAAhB,EAAoB;AACvCb,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,KAAK,EAAEpB,OADT;AAEEqB,MAAAA,EAAE,EAAE;AAFN,KADO,EAKP;AACED,MAAAA,KAAK,EAAErB,OADT;AAEEsB,MAAAA,EAAE,EAAE;AAFN,KALO,EASP;AACED,MAAAA,KAAK,EAAElB,MADT;AAEEmB,MAAAA,EAAE,EAAE;AAFN,KATO,EAaP;AACED,MAAAA,KAAK,EAAEnB,UADT;AAEEoB,MAAAA,EAAE,EAAE;AAFN,KAbO;AAD8B,GAApB,CAArB;AAoBAb,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBS,MAArB;AACD,CAvBD;;AAwBA5B,UAAU,CAAC0B,aAAX,GAA2BA,aAA3B;;AAEA,MAAMI,YAAY,GAAG,OAAO5B,GAAP,EAAYC,GAAZ,KAAoB;AACvC,QAAM;AACJ4B,IAAAA,cADI;AAEJC,IAAAA,aAFI;AAGJC,IAAAA,SAHI;AAIJC,IAAAA,cAJI;AAKJC,IAAAA,cALI;AAMJC,IAAAA,mBANI;AAOJC,IAAAA,cAPI;AAQJC,IAAAA,eARI;AASJC,IAAAA,aATI;AAUJC,IAAAA,cAVI;AAWJC,IAAAA,eAXI;AAYJC,IAAAA;AAZI,MAaFxC,GAAG,CAACyC,IAbR;AAcA,QAAMC,YAAY,GAAG,IAAIC,IAAJ,EAArB;AACA,QAAMC,cAAc,GAAG5C,GAAG,CAAC6C,IAAJ,EAAUC,IAAV,IAAkB,IAAzC;AACA,QAAMpB,MAAM,GAAG,MAAMnC,MAAM,CAACwD,MAAP,CAAc;AACjClB,IAAAA,cADiC;AAEjCa,IAAAA,YAFiC;AAGjCZ,IAAAA,aAHiC;AAIjCC,IAAAA,SAJiC;AAKjCiB,IAAAA,cAAc,EAAEJ;AALiB,GAAd,CAArB;AAOA,QAAMK,UAAU,GAAG,MAAMvD,UAAU,CAACqD,MAAX,CAAkB;AACzCf,IAAAA,cADyC;AAEzCC,IAAAA,cAFyC;AAGzCC,IAAAA,mBAHyC;AAIzCC,IAAAA,cAJyC;AAKzCC,IAAAA,eALyC;AAMzCC,IAAAA,aANyC;AAOzCC,IAAAA,cAPyC;AAQzCC,IAAAA,eARyC;AASzCC,IAAAA,oBATyC;AAUzCU,IAAAA,SAAS,EAAExB,MAAM,CAACD;AAVuB,GAAlB,CAAzB;AAYAxB,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBS,MAArB;AACD,CArCD;;AAsCA5B,UAAU,CAAC8B,YAAX,GAA0BA,YAA1B;;AAEA,MAAMuB,iCAAiC,GAAG,OAAOnD,GAAP,EAAYC,GAAZ,KAAoB;AAC5D,QAAM;AACJ4B,IAAAA,cADI;AAEJC,IAAAA,aAFI;AAGJC,IAAAA,SAHI;AAIJqB,IAAAA,SAJI;AAKJC,IAAAA,SALI;AAMJrB,IAAAA,cANI;AAOJC,IAAAA,cAPI;AAQJC,IAAAA,mBARI;AASJC,IAAAA,cATI;AAUJC,IAAAA,eAVI;AAWJC,IAAAA,aAXI;AAYJC,IAAAA,cAZI;AAaJC,IAAAA,eAbI;AAcJC,IAAAA;AAdI,MAeFxC,GAAG,CAACyC,IAfR;AAgBA,QAAMG,cAAc,GAAG5C,GAAG,CAAC6C,IAAJ,EAAUC,IAAV,IAAkB,IAAzC;AACA,QAAMG,UAAU,GAAG,MAAMvD,UAAU,CAACqD,MAAX,CAAkB;AACzCf,IAAAA,cADyC;AAEzCC,IAAAA,cAFyC;AAGzCC,IAAAA,mBAHyC;AAIzCC,IAAAA,cAJyC;AAKzCC,IAAAA,eALyC;AAMzCC,IAAAA,aANyC;AAOzCC,IAAAA,cAPyC;AAQzCC,IAAAA,eARyC;AASzCC,IAAAA;AATyC,GAAlB,CAAzB;AAWA,QAAME,YAAY,GAAG,IAAIC,IAAJ,EAArB;AACA,QAAMjB,MAAM,GAAG,MAAMnC,MAAM,CAACwD,MAAP,CAAc;AACjClB,IAAAA,cADiC;AAEjCa,IAAAA,YAFiC;AAGjCZ,IAAAA,aAHiC;AAIjCC,IAAAA,SAJiC;AAKjCiB,IAAAA,cAAc,EAAEJ,cALiB;AAMjCQ,IAAAA,SANiC;AAOjCC,IAAAA,SAPiC;AAQjCC,IAAAA,YAAY,EAAEL,UAAU,CAACxB,EARQ;AASjC8B,IAAAA,QAAQ,EAAE;AATuB,GAAd,CAArB;AAWA,QAAMC,2BAA2B,GAAG,MAAMjE,MAAM,CAACoC,QAAP,CAAgBD,MAAM,CAACD,EAAvB,EAA2B;AACnEb,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,KAAK,EAAEpB,OADT;AAEEqB,MAAAA,EAAE,EAAE;AAFN,KADO,EAKP;AACED,MAAAA,KAAK,EAAErB,OADT;AAEEsB,MAAAA,EAAE,EAAE;AAFN,KALO,EASP;AACED,MAAAA,KAAK,EAAEnB,UADT;AAEEoB,MAAAA,EAAE,EAAE;AAFN,KATO;AAD0D,GAA3B,CAA1C;AAgBA,QAAMmC,UAAU,CAACQ,MAAX,CAAkB;AAAEP,IAAAA,SAAS,EAAExB,MAAM,CAACD;AAApB,GAAlB,EAA4C;AAAE8B,IAAAA,QAAQ,EAAE;AAAZ,GAA5C,CAAN;AACAtD,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBuC,2BAArB;AACD,CA3DD;;AA4DA1D,UAAU,CAACqD,iCAAX,GAA+CA,iCAA/C,C,CAEA;;AACA,MAAMO,YAAY,GAAG,OAAO1D,GAAP,EAAYC,GAAZ,KAAoB;AACvC,QAAM0D,QAAQ,GAAG3D,GAAG,CAACI,MAAJ,CAAWqB,EAA5B;AACA,QAAM;AAAEI,IAAAA,cAAF;AAAkBC,IAAAA,aAAlB;AAAiCkB,IAAAA,cAAjC;AAAiDjB,IAAAA;AAAjD,MAA+D/B,GAAG,CAACyC,IAAzE;AACA,QAAMf,MAAM,GAAG,MAAMnC,MAAM,CAACoC,QAAP,CAAgBgC,QAAhB,CAArB;AACA,QAAMjC,MAAM,CAAC+B,MAAP,CAAc;AAClB5B,IAAAA,cADkB;AAElBC,IAAAA,aAFkB;AAGlBkB,IAAAA,cAHkB;AAIlBjB,IAAAA;AAJkB,GAAd,CAAN;AAMA9B,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBS,MAArB;AACD,CAXD;;AAYA5B,UAAU,CAAC4D,YAAX,GAA0BA,YAA1B;;AAEA,MAAME,kBAAkB,GAAG,OAAO5D,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,QAAM4D,QAAQ,GAAG7D,GAAG,CAACI,MAAJ,CAAWqB,EAA5B;AACA,QAAMqC,KAAK,GAAG9D,GAAG,CAACI,MAAJ,CAAW2D,GAAzB;AACA,QAAMrC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,QAAP,CAAgBkC,QAAhB,CAArB;AACA,QAAMnC,MAAM,CAAC+B,MAAP,CAAc;AAAEF,IAAAA,QAAQ,EAAEO;AAAZ,GAAd,CAAN;AACA,QAAME,iBAAiB,GAAG,MAAMzE,MAAM,CAACoC,QAAP,CAAgBkC,QAAhB,EAA0B;AACxDjD,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,KAAK,EAAErB,OADT;AAEEsB,MAAAA,EAAE,EAAE;AAFN,KADO,EAKP;AACED,MAAAA,KAAK,EAAEpB,OADT;AAEEqB,MAAAA,EAAE,EAAE;AAFN,KALO,EASP;AACED,MAAAA,KAAK,EAAElB,MADT;AAEEmB,MAAAA,EAAE,EAAE;AAFN,KATO,EAaP;AACED,MAAAA,KAAK,EAAEnB,UADT;AAEEoB,MAAAA,EAAE,EAAE;AAFN,KAbO;AAD+C,GAA1B,CAAhC;AAoBAb,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB+C,iBAArB;AACD,CA1BD;;AA2BAlE,UAAU,CAAC8D,kBAAX,GAAgCA,kBAAhC;;AAEA,MAAMK,YAAY,GAAG,OAAOjE,GAAP,EAAYC,GAAZ,KAAoB;AACvC,QAAMwB,EAAE,GAAGzB,GAAG,CAACI,MAAJ,CAAWqB,EAAtB;AACA,QAAMC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,QAAP,CAAgBF,EAAhB,CAArB;AACA,QAAMC,MAAM,CAAC+B,MAAP,CAAc;AAAE9C,IAAAA,MAAM,EAAE;AAAV,GAAd,CAAN;AACAV,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAErB,IAAAA,OAAO,EAAE;AAAX,GAArB;AACD,CALD;;AAMAE,UAAU,CAACmE,YAAX,GAA0BA,YAA1B;;AAEA,MAAMC,cAAc,GAAG,OAAOlE,GAAP,EAAYC,GAAZ,KAAoB;AACzC,QAAMwB,EAAE,GAAGzB,GAAG,CAACI,MAAJ,CAAWqB,EAAtB;AACA,QAAMC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,QAAP,CAAgBF,EAAhB,CAArB;AACA,QAAMC,MAAM,CAAC+B,MAAP,CAAc;AAAE9C,IAAAA,MAAM,EAAE;AAAV,GAAd,CAAN;AACAV,EAAAA,GAAG,CAACe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBS,MAArB;AACD,CALD;;AAMA5B,UAAU,CAACoE,cAAX,GAA4BA,cAA5B;AAEAC,MAAM,CAACC,OAAP,GAAiBtE,UAAjB","sourcesContent":["const { includes } = require(\"lodash\");\r\nconst { Remito, Cliente, Destino, Mercaderia, Estado } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst { off } = require(\"../app\");\r\nconst controller = {};\r\n\r\nconst getRemitos = async (req, res) => {\r\n  const page = parseInt(req.params.page) || 1;\r\n  const limit = parseInt(req.params.limit) || 20;\r\n  const offset = (page - 1) * limit; // permite saltear los que son de paginas anteriores\r\n  const { count, rows } = await Remito.findAndCountAll({\r\n    where: { activo: true },\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n      {\r\n        model: Mercaderia,\r\n        as: \"mercaderia\",\r\n      },\r\n    ],\r\n    limit,\r\n    offset,\r\n    order: [[\"createdAt\", \"DESC\"]], //revisar atributo que toma para el orden\r\n  });\r\n  res.status(200).json({\r\n    totalItems: count,\r\n    totalPages: Math.ceil(count / limit),\r\n    currentPage: page,\r\n    data: rows,\r\n  });\r\n};\r\ncontroller.getRemitos = getRemitos;\r\n\r\nconst getRemitoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id, {\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n      {\r\n        model: Mercaderia,\r\n        as: \"mercaderia\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(200).json(remito);\r\n};\r\ncontroller.getRemitoById = getRemitoById;\r\n\r\nconst createRemito = async (req, res) => {\r\n  const {\r\n    numeroAsignado,\r\n    observaciones,\r\n    prioridad,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n  } = req.body;\r\n  const fechaEmision = new Date();\r\n  const archivoEnviado = req.file?.path || null;\r\n  const remito = await Remito.create({\r\n    numeroAsignado,\r\n    fechaEmision,\r\n    observaciones,\r\n    prioridad,\r\n    archivoAdjunto: archivoEnviado,\r\n  });\r\n  const mercaderia = await Mercaderia.create({\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    remitosId: remito.id,\r\n  });\r\n  res.status(201).json(remito);\r\n};\r\ncontroller.createRemito = createRemito;\r\n\r\nconst createRemitoWithClienteAndDestino = async (req, res) => {\r\n  const {\r\n    numeroAsignado,\r\n    observaciones,\r\n    prioridad,\r\n    clienteId,\r\n    destinoId,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n  } = req.body;\r\n  const archivoEnviado = req.file?.path || null;\r\n  const mercaderia = await Mercaderia.create({\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n  });\r\n  const fechaEmision = new Date();\r\n  const remito = await Remito.create({\r\n    numeroAsignado,\r\n    fechaEmision,\r\n    observaciones,\r\n    prioridad,\r\n    archivoAdjunto: archivoEnviado,\r\n    clienteId,\r\n    destinoId,\r\n    mercaderiaId: mercaderia.id,\r\n    estadoId: 1,\r\n  });\r\n  const remitoWithDestinoAndCliente = await Remito.findByPk(remito.id, {\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Mercaderia,\r\n        as: \"mercaderia\",\r\n      },\r\n    ],\r\n  });\r\n  await mercaderia.update({ remitosId: remito.id }, { estadoId: 1 });\r\n  res.status(201).json(remitoWithDestinoAndCliente);\r\n};\r\ncontroller.createRemitoWithClienteAndDestino = createRemitoWithClienteAndDestino;\r\n\r\n//CONSULTAR SI VA PORQUE SOLO CAMBIA ESTADOS\r\nconst updateRemito = async (req, res) => {\r\n  const idRemito = req.params.id;\r\n  const { numeroAsignado, observaciones, archivoAdjunto, prioridad } = req.body;\r\n  const remito = await Remito.findByPk(idRemito);\r\n  await remito.update({\r\n    numeroAsignado,\r\n    observaciones,\r\n    archivoAdjunto,\r\n    prioridad,\r\n  });\r\n  res.status(200).json(remito);\r\n};\r\ncontroller.updateRemito = updateRemito;\r\n\r\nconst updateEstadoRemito = async (req, res) => {\r\n  const remitoId = req.params.id;\r\n  const estId = req.params.eid;\r\n  const remito = await Remito.findByPk(remitoId);\r\n  await remito.update({ estadoId: estId });\r\n  const remitoActualizado = await Remito.findByPk(remitoId, {\r\n    include: [\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n      {\r\n        model: Mercaderia,\r\n        as: \"mercaderia\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(200).json(remitoActualizado);\r\n};\r\ncontroller.updateEstadoRemito = updateEstadoRemito;\r\n\r\nconst deleteRemito = async (req, res) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id);\r\n  await remito.update({ activo: false });\r\n  res.status(200).json({ message: \"Remito eliminado correctamente\" });\r\n};\r\ncontroller.deleteRemito = deleteRemito;\r\n\r\nconst activateRemito = async (req, res) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id);\r\n  await remito.update({ activo: true });\r\n  res.status(200).json(remito);\r\n};\r\ncontroller.activateRemito = activateRemito;\r\n\r\nmodule.exports = controller;\r\n"],"file":"remitoController.js"}