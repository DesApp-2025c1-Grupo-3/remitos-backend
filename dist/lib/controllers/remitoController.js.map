{"version":3,"sources":["../../../lib/controllers/remitoController.js"],"names":["includes","require","Remito","Cliente","Destino","Contacto","Estado","message","controller","getRemitos","req","res","remitos","findAll","include","model","as","status","json","getRemitoById","id","params","remito","findByPk","createRemito","numeroAsignado","tipoMercaderia","valorDeclarado","volumenMetrosCubico","pesoMercaderia","cantidadBobinas","cantidadRacks","cantidadBultos","cantidadPallets","requisitosEspeciales","observaciones","body","fechaEmision","Date","archivoEnviado","file","path","create","archivoAdjunto","createRemitoWithClienteAndDestino","clienteId","destinoId","estadoId","remitoWithDestinoAndCliente","updateRemito","idRemito","update","updateEstadoRemito","remitoId","estId","eid","remitoActualizado","deleteRemito","activo","module","exports"],"mappings":"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","sourcesContent":["const { includes } = require(\"lodash\");\r\nconst { Remito, Cliente, Destino, Contacto, Estado } = require(\"../models\");\r\nconst { message } = require(\"../schemas/estadoSchema\");\r\nconst controller = {};\r\n\r\nconst getRemitos = async (req, res) => {\r\n  const remitos = await Remito.findAll({\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(200).json(remitos);\r\n};\r\ncontroller.getRemitos = getRemitos;\r\n\r\nconst getRemitoById = async (req, res) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id, {\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(200).json(remito);\r\n};\r\ncontroller.getRemitoById = getRemitoById;\r\n\r\nconst createRemito = async (req, res) => {\r\n  const {\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n  } = req.body;\r\n  const fechaEmision = new Date();\r\n  const archivoEnviado = req.file?.path || null;\r\n  const remito = await Remito.create({\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    fechaEmision,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n    archivoAdjunto: archivoEnviado,\r\n  });\r\n  res.status(201).json(remito);\r\n};\r\ncontroller.createRemito = createRemito;\r\n\r\nconst createRemitoWithClienteAndDestino = async (req, res) => {\r\n  const {\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n    clienteId,\r\n    destinoId,\r\n  } = req.body;\r\n  const archivoEnviado = req.file?.path || null;\r\n  const fechaEmision = new Date();\r\n  const remito = await Remito.create({\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    fechaEmision,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n    archivoAdjunto: archivoEnviado,\r\n    clienteId,\r\n    destinoId,\r\n    estadoId: 1,\r\n  });\r\n  const remitoWithDestinoAndCliente = await Remito.findByPk(remito.id, {\r\n    include: [\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(201).json(remitoWithDestinoAndCliente);\r\n};\r\ncontroller.createRemitoWithClienteAndDestino = createRemitoWithClienteAndDestino;\r\n\r\nconst updateRemito = async (req, res) => {\r\n  const idRemito = req.params.id;\r\n  const {\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    fechaEmision,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n    archivoAdjunto,\r\n  } = req.body;\r\n  const remito = await Remito.findByPk(idRemito);\r\n  await remito.update({\r\n    numeroAsignado,\r\n    tipoMercaderia,\r\n    valorDeclarado,\r\n    volumenMetrosCubico,\r\n    pesoMercaderia,\r\n    fechaEmision,\r\n    cantidadBobinas,\r\n    cantidadRacks,\r\n    cantidadBultos,\r\n    cantidadPallets,\r\n    requisitosEspeciales,\r\n    observaciones,\r\n    archivoAdjunto,\r\n  });\r\n  res.status(200).json(remito);\r\n};\r\ncontroller.updateRemito = updateRemito;\r\n\r\nconst updateEstadoRemito = async (req, res) => {\r\n  const remitoId = req.params.id;\r\n  const estId = req.params.eid;\r\n  const remito = await Remito.findByPk(remitoId);\r\n  await remito.update({ estadoId: estId });\r\n  const remitoActualizado = await Remito.findByPk(remitoId, {\r\n    include: [\r\n      {\r\n        model: Cliente,\r\n        as: \"cliente\",\r\n      },\r\n      {\r\n        model: Destino,\r\n        as: \"destino\",\r\n      },\r\n      {\r\n        model: Estado,\r\n        as: \"estado\",\r\n      },\r\n    ],\r\n  });\r\n  res.status(200).json(remitoActualizado);\r\n};\r\ncontroller.updateEstadoRemito = updateEstadoRemito;\r\n\r\n// Este es el metodo de eliminación que lo marca como inactivo\r\nconst deleteRemito = async (req, res) => {\r\n  const remitoId = req.params.id;\r\n  const remito = await Remito.findByPk(remitoId);\r\n  await remito.update({ activo: false });\r\n  res.status(200).json({ message: \"Remito eliminado.\" });\r\n};\r\ncontroller.deleteRemito = deleteRemito;\r\n\r\n/*   // Este es el metodo de eliminación que lo borra del todo\r\nconst deleteRemito = async (req, res) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id);\r\n  await remito.destroy();\r\n  res.status(200).json({ message: \"Remito eliminado correctamente\" });\r\n};\r\ncontroller.deleteRemito = deleteRemito;\r\n*/\r\n\r\nmodule.exports = controller;\r\n"],"file":"remitoController.js"}