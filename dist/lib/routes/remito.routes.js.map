{"version":3,"sources":["../../../lib/routes/remito.routes.js"],"names":["express","require","route","Router","multer","path","fs","remitoController","schemaValidator","remitoMiddleware","remitoSchema","upload","handleMulterError","error","req","res","next","MulterError","code","status","json","message","get","getRemitos","validateRemitoId","getRemitoById","post","single","validateNumeroAsignadoUnico","createRemito","createRemitoWithClienteAndDestino","put","validateNumeroAsignadoUnicoUpdate","updateRemito","updateEstadoRemito","delete","deleteRemito","getVolumenPorClientePeriodo","filename","params","includes","filePath","join","__dirname","existsSync","sendFile","module","exports"],"mappings":"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","sourcesContent":["const express = require(\"express\");\nconst route = express.Router();\nconst multer = require(\"multer\");\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst remitoController = require(\"../controllers/remitoController\");\nconst schemaValidator = require(\"../middlewares/schemaValidator\");\nconst remitoMiddleware = require(\"../middlewares/remitoMiddleware\");\nconst remitoSchema = require(\"../schemas/remitoSchema\");\nconst upload = require(\"../middlewares/upload\");\n\n// Middleware para manejar errores de multer\nconst handleMulterError = (error, req, res, next) => {\n  if (error instanceof multer.MulterError) {\n    if (error.code === \"LIMIT_FILE_SIZE\") {\n      return res.status(400).json({\n        error: \"El archivo es demasiado grande. Máximo 5MB.\",\n      });\n    }\n    return res.status(400).json({\n      error: \"Error al subir el archivo.\",\n    });\n  } else if (error) {\n    return res.status(400).json({\n      error: error.message,\n    });\n  }\n  next();\n};\n\n//Trae todos los remitos\nroute.get(\"/remito\", remitoController.getRemitos);\n//Trae remito por id\nroute.get(\n  \"/remito/:id\",\n  remitoMiddleware.validateRemitoId,\n  remitoController.getRemitoById\n);\n//CREA SOLO EL MODELO REMITO CON SUS ATRIBUTOS\nroute.post(\n  \"/remito\",\n  upload.single(\"archivoAdjunto\"),\n  handleMulterError,\n  schemaValidator(remitoSchema),\n  remitoMiddleware.validateNumeroAsignadoUnico,\n  remitoController.createRemito\n);\n//CREA EL REMITO CON DESTINO Y SU CONTACTO Y CLIENTE Y SU CONTACTO\nroute.post(\n  \"/remitoFinal\",\n  upload.single(\"archivoAdjunto\"),\n  handleMulterError,\n  //schemaValidator(remitoSchema),\n  remitoMiddleware.validateNumeroAsignadoUnico,\n  remitoController.createRemitoWithClienteAndDestino\n);\n//Edita remito\nroute.put(\n  \"/remito/:id\",\n  remitoMiddleware.validateRemitoId,\n  remitoMiddleware.validateNumeroAsignadoUnicoUpdate,\n  remitoController.updateRemito\n);\n//Edita estado de un remito\nroute.put(\"/remito/:id/estado/:eid\", remitoController.updateEstadoRemito);\n\n//Borra remito\nroute.delete(\n  \"/remito/:id\",\n  remitoMiddleware.validateRemitoId,\n  remitoController.deleteRemito\n);\n\nroute.get(\n  \"/reportes/volumen-por-cliente-periodo\",\n  remitoController.getVolumenPorClientePeriodo\n);\n\n// Endpoint para servir archivos de manera segura\nroute.get(\"/archivo/:filename\", (req, res) => {\n  const { filename } = req.params;\n\n  // Validar que el nombre del archivo sea seguro\n  if (!filename || filename.includes(\"..\") || filename.includes(\"/\")) {\n    return res.status(400).json({ error: \"Nombre de archivo inválido\" });\n  }\n\n  const filePath = path.join(__dirname, \"../../uploads/remitos\", filename);\n\n  // Verificar que el archivo existe\n  if (!fs.existsSync(filePath)) {\n    return res.status(404).json({ error: \"Archivo no encontrado\" });\n  }\n\n  res.sendFile(filePath);\n});\n\nmodule.exports = route;\n"],"file":"remito.routes.js"}