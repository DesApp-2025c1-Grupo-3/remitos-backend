{"version":3,"sources":["../../../lib/middlewares/remitoMiddleware.js"],"names":["Remito","require","Op","middleware","validateRemitoId","req","res","next","id","params","remito","findByPk","status","json","message","validateNumeroAsignadoUnico","numeroAsignado","body","remitoExistente","findOne","where","error","console","validateNumeroAsignadoUnicoUpdate","ne","module","exports"],"mappings":"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","sourcesContent":["const { Remito } = require(\"../models\");\r\nconst { Op } = require(\"sequelize\");\r\nconst middleware = {};\r\n\r\nconst validateRemitoId = async (req, res, next) => {\r\n  const id = req.params.id;\r\n  const remito = await Remito.findByPk(id);\r\n  if (!remito) {\r\n    return res.status(404).json({ message: `El remito con id ${id} no existe` });\r\n  }\r\n  next();\r\n};\r\n\r\nconst validateNumeroAsignadoUnico = async (req, res, next) => {\r\n  const { numeroAsignado } = req.body;\r\n  \r\n  if (!numeroAsignado) {\r\n    return next(); // Si no hay numeroAsignado, no validamos unicidad\r\n  }\r\n\r\n  try {\r\n    const remitoExistente = await Remito.findOne({\r\n      where: { numeroAsignado }\r\n    });\r\n\r\n    if (remitoExistente) {\r\n      return res.status(409).json({ \r\n        message: \"El número asignado ya está en uso\" \r\n      });\r\n    }\r\n\r\n    next();\r\n  } catch (error) {\r\n    console.error(\"Error al validar unicidad del número asignado:\", error);\r\n    return res.status(500).json({ \r\n      message: \"Error al validar el número asignado\" \r\n    });\r\n  }\r\n};\r\n\r\nconst validateNumeroAsignadoUnicoUpdate = async (req, res, next) => {\r\n  const { numeroAsignado } = req.body;\r\n  const { id } = req.params;\r\n  \r\n  if (!numeroAsignado) {\r\n    return next(); // Si no hay numeroAsignado, no validamos unicidad\r\n  }\r\n\r\n  try {\r\n    const remitoExistente = await Remito.findOne({\r\n      where: { \r\n        numeroAsignado,\r\n        id: { [Op.ne]: id } // Excluir el remito actual\r\n      }\r\n    });\r\n\r\n    if (remitoExistente) {\r\n      return res.status(409).json({ \r\n        message: \"El número asignado ya está en uso\" \r\n      });\r\n    }\r\n\r\n    next();\r\n  } catch (error) {\r\n    console.error(\"Error al validar unicidad del número asignado:\", error);\r\n    return res.status(500).json({ \r\n      message: \"Error al validar el número asignado\" \r\n    });\r\n  }\r\n};\r\n\r\nmiddleware.validateRemitoId = validateRemitoId;\r\nmiddleware.validateNumeroAsignadoUnico = validateNumeroAsignadoUnico;\r\nmiddleware.validateNumeroAsignadoUnicoUpdate = validateNumeroAsignadoUnicoUpdate;\r\n\r\nmodule.exports = middleware;\r\n"],"file":"remitoMiddleware.js"}